{% extends "chine/base.html" %}
{% load humanize %}

{% block header %}Vue d'ensemble{% endblock %}

{% block chine_content %}
<div class="space-y-6">
    <!-- Quick Actions -->
    <div class="flex justify-end space-x-3">
        <a href="{% url 'chine:client_add' %}"
            class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
            <svg class="-ml-1 mr-2 h-5 w-5 text-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                fill="currentColor">
                <path
                    d="M8 9a3 3 0 100-6 3 3 0 000 6zM8 11a6 6 0 016 6H2a6 6 0 016-6zM16 7a1 1 0 10-2 0v1h-1a1 1 0 100 2h1v1a1 1 0 102 0v-1h1a1 1 0 100-2h-1V7z" />
            </svg>
            Nouveau Client
        </a>
        {% if user.role == 'AGENT_CHINE' %}
        <a href="{% url 'chine:lot_create' %}"
            class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
            <svg class="-ml-1 mr-2 h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd"
                    d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z"
                    clip-rule="evenodd" />
            </svg>
            Nouveau Lot
        </a>
        {% endif %}
        <a href="{% url 'chine:country_add' %}"
            class="{% if user.role != 'ADMIN_CHINE' %}hidden{% endif %} ml-3 inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
            <svg class="-ml-1 mr-2 h-5 w-5 text-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z" clip-rule="evenodd" />
            </svg>
            Nouveau Pays
        </a>
    </div>

    <!-- Stats Grid -->
    <div class="grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4">
        {% if user.role == 'ADMIN_CHINE' %}
        <!-- ADMIN STATS - Double Colonne (Mali vs CI) -->
        <div class="col-span-1 sm:col-span-2 lg:col-span-4 grid grid-cols-1 lg:grid-cols-2 gap-6">
            
            <!-- Colonne MALI -->
            <div class="bg-white overflow-hidden shadow rounded-xl border-t-4 border-green-500">
                <div class="px-4 py-5 sm:p-6">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center">
                            <h3 class="text-lg leading-6 font-medium text-gray-900 flex items-center">
                                <span class="text-2xl mr-2">üá≤üá±</span> Mali
                            </h3>
                            <span class="ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800">
                                Mois en cours
                            </span>
                        </div>
                        <div class="flex space-x-2">
                            <a href="{% url 'chine:monthly_archives' %}" class="text-xs font-medium text-indigo-600 hover:text-indigo-500">
                                Voir Archives &rarr;
                            </a>
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                {{ stats_ml.nb_lots }} lots
                            </span>
                        </div>
                    </div>
                    
                    <dl class="grid grid-cols-1 gap-5 sm:grid-cols-2">
                        <div class="px-4 py-5 bg-gray-50 shadow rounded-lg overflow-hidden sm:p-6">
                            <dt class="text-sm font-medium text-gray-500 truncate">Chiffre d'Affaires</dt>
                            <dd class="mt-1 text-xl font-semibold text-gray-900">{{ stats_ml.montant_colis|default:"0"|floatformat:0|intcomma }} FCFA</dd>
                        </div>
                        <div class="px-4 py-5 bg-gray-50 shadow rounded-lg overflow-hidden sm:p-6">
                            <dt class="text-sm font-medium text-gray-500 truncate">Poids Total</dt>
                            <dd class="mt-1 text-xl font-semibold text-gray-900">{{ stats_ml.poids_total|default:"0"|floatformat:1|intcomma }} kg</dd>
                        </div>
                        <div class="px-4 py-5 bg-gray-50 shadow rounded-lg overflow-hidden sm:p-6">
                            <dt class="text-sm font-medium text-gray-500 truncate">Total D√©penses</dt>
                            <dd class="mt-1 text-xl font-semibold text-red-600">- {{ stats_ml.cout_transport|add:stats_ml.cout_douane|add:stats_ml.total_depenses_global|floatformat:0|intcomma }} FCFA</dd>
                        </div>
                        <div class="px-4 py-5 bg-green-50 shadow rounded-lg overflow-hidden sm:p-6">
                            <dt class="text-sm font-medium text-green-800 truncate">B√©n√©fice Net</dt>
                            <dd class="mt-1 text-xl font-bold text-green-900">{{ stats_ml.benefice|default:"0"|floatformat:0|intcomma }} FCFA</dd>
                        </div>
                    </dl>

                    <!-- R√©mun√©ration Agents -->
                    <div class="mt-6 border-t border-gray-200 pt-4">
                        <h4 class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3">R√©mun√©ration Agents (Estim√©e)</h4>
                        <div class="bg-gray-50 shadow overflow-hidden sm:rounded-md">
                            <ul class="divide-y divide-gray-200">
                                {% for item in stats_ml.agents_remuneration %}
                                <li class="px-4 py-3 flex items-center justify-between hover:bg-gray-100 transition duration-150">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0 h-8 w-8 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-700 font-bold text-xs uppercase">
                                            {{ item.agent.username|slice:":2" }}
                                        </div>
                                        <div class="ml-3">
                                            <p class="text-sm font-medium text-gray-900">{{ item.agent.get_full_name|default:item.agent.username }}</p>
                                            <p class="text-xs text-gray-500">{{ item.mode }} : {{ item.valeur|floatformat:0 }} {% if item.mode == 'Commission (%)' %}%{% else %}FCFA{% endif %}</p>
                                        </div>
                                    </div>
                                    <div class="text-sm font-bold text-gray-900">
                                        {{ item.montant|floatformat:0|intcomma }} FCFA
                                    </div>
                                </li>
                                {% empty %}
                                <li class="px-4 py-3 text-sm text-gray-500 italic">Aucun agent configur√©.</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Colonne C√îTE D'IVOIRE -->
            <div class="bg-white overflow-hidden shadow rounded-xl border-t-4 border-orange-500">
                <div class="px-4 py-5 sm:p-6">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center">
                            <h3 class="text-lg leading-6 font-medium text-gray-900 flex items-center">
                                <span class="text-2xl mr-2">üá®üáÆ</span> C√¥te d'Ivoire
                            </h3>
                            <span class="ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800">
                                Mois en cours
                            </span>
                        </div>
                        <div class="flex space-x-2">
                            <a href="{% url 'chine:monthly_archives' %}" class="text-xs font-medium text-indigo-600 hover:text-indigo-500">
                                Voir Archives &rarr;
                            </a>
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800">
                                {{ stats_ci.nb_lots }} lots
                            </span>
                        </div>
                    </div>
                    
                    <dl class="grid grid-cols-1 gap-5 sm:grid-cols-2">
                        <div class="px-4 py-5 bg-gray-50 shadow rounded-lg overflow-hidden sm:p-6">
                            <dt class="text-sm font-medium text-gray-500 truncate">Chiffre d'Affaires</dt>
                            <dd class="mt-1 text-xl font-semibold text-gray-900">{{ stats_ci.montant_colis|default:"0"|floatformat:0|intcomma }} FCFA</dd>
                        </div>
                        <div class="px-4 py-5 bg-gray-50 shadow rounded-lg overflow-hidden sm:p-6">
                            <dt class="text-sm font-medium text-gray-500 truncate">Poids Total</dt>
                            <dd class="mt-1 text-xl font-semibold text-gray-900">{{ stats_ci.poids_total|default:"0"|floatformat:1|intcomma }} kg</dd>
                        </div>
                        <div class="px-4 py-5 bg-gray-50 shadow rounded-lg overflow-hidden sm:p-6">
                            <dt class="text-sm font-medium text-gray-500 truncate">Total D√©penses</dt>
                            <dd class="mt-1 text-xl font-semibold text-red-600">- {{ stats_ci.cout_transport|add:stats_ci.cout_douane|add:stats_ci.total_depenses_global|floatformat:0|intcomma }} FCFA</dd>
                        </div>
                        <div class="px-4 py-5 bg-green-50 shadow rounded-lg overflow-hidden sm:p-6">
                            <dt class="text-sm font-medium text-green-800 truncate">B√©n√©fice Net</dt>
                            <dd class="mt-1 text-xl font-bold text-green-900">{{ stats_ci.benefice|default:"0"|floatformat:0|intcomma }} FCFA</dd>
                        </div>
                    </dl>

                    <!-- R√©mun√©ration Agents -->
                    <div class="mt-6 border-t border-gray-200 pt-4">
                        <h4 class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3">R√©mun√©ration Agents (Estim√©e)</h4>
                        <div class="bg-gray-50 shadow overflow-hidden sm:rounded-md">
                            <ul class="divide-y divide-gray-200">
                                {% for item in stats_ci.agents_remuneration %}
                                <li class="px-4 py-3 flex items-center justify-between hover:bg-gray-100 transition duration-150">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0 h-8 w-8 rounded-full bg-orange-100 flex items-center justify-center text-orange-700 font-bold text-xs uppercase">
                                            {{ item.agent.username|slice:":2" }}
                                        </div>
                                        <div class="ml-3">
                                            <p class="text-sm font-medium text-gray-900">{{ item.agent.get_full_name|default:item.agent.username }}</p>
                                            <p class="text-xs text-gray-500">{{ item.mode }} : {{ item.valeur|floatformat:0 }} {% if item.mode == 'Commission (%)' %}%{% else %}FCFA{% endif %}</p>
                                        </div>
                                    </div>
                                    <div class="text-sm font-bold text-gray-900">
                                        {{ item.montant|floatformat:0|intcomma }} FCFA
                                    </div>
                                </li>
                                {% empty %}
                                <li class="px-4 py-3 text-sm text-gray-500 italic">Aucun agent configur√©.</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            
        </div>

        <!-- Totaux Gloaux -->
        <div class="col-span-1 sm:col-span-2 lg:col-span-4 mt-4">
            <h3 class="text-lg font-medium leading-6 text-gray-900 mb-2">Totaux Globaux</h3>
            <div class="grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4">
                 <div class="bg-white overflow-hidden shadow rounded-lg">
                    <div class="p-5">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-indigo-500 rounded-md p-3">
                                <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <dt class="text-sm font-medium text-gray-500 truncate">Total CA</dt>
                                <dd class="text-lg font-medium text-gray-900">{{ montant_total_colis|default:"0"|floatformat:0|intcomma }}</dd>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white overflow-hidden shadow rounded-lg">
                    <div class="p-5">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-green-500 rounded-md p-3">
                                <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" />
                                </svg>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <dt class="text-sm font-medium text-gray-500 truncate">B√©n√©fice Total</dt>
                                <dd class="text-lg font-medium text-gray-900">{{ benefice_global|default:"0"|floatformat:0|intcomma }}</dd>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white overflow-hidden shadow rounded-lg">
                    <div class="p-5">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-blue-500 rounded-md p-3">
                                <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
                                </svg>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <dt class="text-sm font-medium text-gray-500 truncate">Lots Totaux</dt>
                                <dd class="text-lg font-medium text-gray-900">{{ total_lots|intcomma }}</dd>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white overflow-hidden shadow rounded-lg">
                    <div class="p-5">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-rose-500 rounded-md p-3">
                                <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
                                </svg>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <dt class="text-sm font-medium text-gray-500 truncate">Total Agents</dt>
                                <dd class="text-lg font-medium text-gray-900">{{ total_agents_count|intcomma }}</dd>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Graphique Admin -->
        <div class="lg:col-span-4 bg-white p-6 shadow rounded-xl">
            <h3 class="text-lg font-bold text-gray-900 mb-4">Volume des Colis (Evolution 6 mois)</h3>
            <div class="h-64">
                <canvas id="performanceChart"></canvas>
            </div>
        </div>

        {% else %}
        <!-- AGENT CHINE STATS (8 cards r√©organis√©es) -->
        
        <!-- Lots en Transit (d√©plac√© en premier) -->
        <div class="bg-white overflow-hidden shadow rounded-lg bg-blue-50/30 border border-blue-100">
            <div class="p-5">
                <div class="flex items-center">
                    <div class="flex-shrink-0 bg-blue-600 rounded-md p-3">
                        <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                        </svg>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                        <dt class="text-sm font-medium text-blue-700 truncate">Lots en Transit</dt>
                        <dd class="text-2xl font-semibold text-gray-900">{{ lots_transit_count|default:"0" }}</dd>
                    </div>
                </div>
            </div>
        </div>

        <!-- Lots Arriv√©s au Mali (d√©plac√© en deuxi√®me) -->
        <div class="bg-white overflow-hidden shadow rounded-lg bg-green-50/30 border border-green-100">
            <div class="p-5">
                <div class="flex items-center">
                    <div class="flex-shrink-0 bg-green-600 rounded-md p-3">
                        <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                        <dt class="text-sm font-medium text-green-700 truncate">Lots Arriv√©s au Mali</dt>
                        <dd class="text-2xl font-semibold text-gray-900">{{ lots_arrives_mali_count|default:"0" }}</dd>
                    </div>
                </div>
            </div>
            <div class="bg-gray-50 px-5 py-3"><div class="text-sm"><a href="{% url 'chine:lot_list' %}" class="font-medium text-green-600 hover:text-green-900">Voir les lots disponibles</a></div></div>
        </div>
        
        <!-- Lots Ouverts -->
        <div class="bg-white overflow-hidden shadow rounded-lg relative">
            <div class="p-5">
                <div class="flex items-center">
                    <div class="flex-shrink-0 bg-indigo-500 rounded-md p-3">
                        <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
                        </svg>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                        <dt class="text-sm font-medium text-gray-500 truncate">Lots Ouverts</dt>
                        <dd class="text-2xl font-semibold text-gray-900">{{ lots_ouverts_count|default:"0" }}</dd>
                    </div>
                </div>
            </div>
            <div class="bg-gray-50 px-5 py-3"><div class="text-sm"><a href="{% url 'chine:lot_list' %}" class="font-medium text-indigo-600 hover:text-indigo-900">Voir les lots ouverts</a></div></div>
        </div>

        <!-- Lots Ferm√©s -->
        <div class="bg-white overflow-hidden shadow rounded-lg relative">
            <div class="p-5">
                <div class="flex items-center">
                    <div class="flex-shrink-0 bg-amber-500 rounded-md p-3">
                        <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                        </svg>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                        <dt class="text-sm font-medium text-gray-500 truncate">Lots Ferm√©s</dt>
                        <dd class="text-2xl font-semibold text-gray-900">{{ lots_fermes_count|default:"0" }}</dd>
                    </div>
                </div>
            </div>
            <div class="bg-gray-50 px-5 py-3"><div class="text-sm"><a href="{% url 'chine:lot_list' %}" class="font-medium text-amber-600 hover:text-amber-900">Lots pr√™ts pour exp√©dition</a></div></div>
        </div>

        <!-- Montant Total Colis (nouveau) -->
        <div class="bg-white overflow-hidden shadow rounded-lg bg-emerald-50/30 border border-emerald-100">
            <div class="p-5">
                <div class="flex items-center">
                    <div class="flex-shrink-0 bg-emerald-600 rounded-md p-3">
                        <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                        <dt class="text-sm font-medium text-emerald-700 truncate">Montant Total Colis</dt>
                        <dd class="text-2xl font-semibold text-gray-900">{{ montant_total_colis_agent|default:"0"|floatformat:0|intcomma }} FCFA</dd>
                    </div>
                </div>
            </div>
        </div>

        <!-- Montant Total Transport (nouveau) -->
        <div class="bg-white overflow-hidden shadow rounded-lg bg-purple-50/30 border border-purple-100">
            <div class="p-5">
                <div class="flex items-center">
                    <div class="flex-shrink-0 bg-purple-600 rounded-md p-3">
                        <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path d="M9 17a2 2 0 11-4 0 2 2 0 014 0zM19 17a2 2 0 11-4 0 2 2 0 014 0z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16V6a1 1 0 00-1-1H4a1 1 0 00-1 1v10a1 1 0 001 1h1m8-1a1 1 0 01-1 1H9m4-1V8a1 1 0 011-1h2.586a1 1 0 01.707.293l3.414 3.414a1 1 0 01.293.707V16a1 1 0 01-1 1h-1m-6-1a1 1 0 001 1h3.5a1 1 0 001-1v-1"/>
                        </svg>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                        <dt class="text-sm font-medium text-purple-700 truncate">Montant Total Transport</dt>
                        <dd class="text-2xl font-semibold text-gray-900">{{ montant_total_transport_agent|default:"0"|floatformat:0|intcomma }} FCFA</dd>
                    </div>
                </div>
            </div>
        </div>

        <!-- Total Colis (d√©plac√© vers la fin) -->
        <div class="bg-white overflow-hidden shadow rounded-lg">
            <div class="p-5">
                <div class="flex items-center">
                    <div class="flex-shrink-0 bg-green-500 rounded-md p-3">
                        <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" />
                        </svg>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                        <dt class="text-sm font-medium text-gray-500 truncate">Total Colis Re√ßus</dt>
                        <dd class="text-2xl font-semibold text-gray-900">{{ colis_total_count|default:"0"|intcomma }}</dd>
                    </div>
                </div>
            </div>
        </div>

        <!-- Total Clients (d√©plac√© vers la fin) -->
        <div class="bg-white overflow-hidden shadow rounded-lg">
            <div class="p-5">
                <div class="flex items-center">
                    <div class="flex-shrink-0 bg-blue-500 rounded-md p-3">
                        <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354l1.108 3.41H16.1l-2.074 1.503.791 2.433L12 10.23l-2.817 1.47.791-2.433-2.074-1.503h2.992L12 4.354zm0 5.4a1.8 1.8 0 100-3.6 1.8 1.8 0 000 3.6zM12 11c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
                        </svg>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                        <dt class="text-sm font-medium text-gray-500 truncate">Total Clients</dt>
                        <dd class="text-2xl font-semibold text-gray-900">{{ total_clients_count|default:"0"|intcomma }}</dd>
                    </div>
                </div>
            </div>
            <div class="bg-gray-50 px-5 py-3"><div class="text-sm"><a href="{% url 'chine:client_list' %}" class="font-medium text-blue-600 hover:text-blue-900">Voir tous les clients</a></div></div>
        </div>

        {% endif %}
    </div>

    <!-- Script pour Chart.js -->
    {% if user.role == "ADMIN_CHINE" %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const ctx = document.getElementById('performanceChart').getContext('2d');
            const data = {{ chart_data|safe }};
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map(item => item.month),
                    datasets: [{
                        label: 'Nombre de Colis',
                        data: data.map(item => item.count),
                        borderColor: 'rgb(79, 70, 229)',
                        backgroundColor: 'rgba(79, 70, 229, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        });
    </script>
    {% endif %}

    <!-- Recent Lots Table -->
    <div class="mt-8">
        <div class="flex items-center justify-between mb-4">
            <h2 class="text-lg leading-6 font-medium text-gray-900">Activit√© R√©cente (Lots)</h2>
            <a href="{% url 'chine:lot_list' %}" class="text-sm font-medium text-indigo-600 hover:text-indigo-900">Tout
                voir &rarr;</a>
        </div>

        <div class="flex flex-col">
            <div class="-my-2 overflow-x-auto sm:-mx-6 lg:-mx-8">
                <div class="py-2 align-middle inline-block min-w-full sm:px-6 lg:px-8">
                    <div class="shadow overflow-hidden border-b border-gray-200 sm:rounded-lg">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col"
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Num√©ro Lot
                                    </th>
                                    <th scope="col"
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Destination
                                    </th>
                                    <th scope="col"
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Exp√©dition
                                    </th>
                                    <th scope="col"
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Statut
                                    </th>
                                    <th scope="col"
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Montant Total Colis
                                    </th>
                                    <th scope="col"
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Frais Exp√©dition
                                    </th>
                                    <th scope="col"
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Date Exp.
                                    </th>
                                    <th scope="col"
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Date Cr√©ation
                                    </th>
                                    <th scope="col" class="relative px-6 py-3">
                                        <span class="sr-only">Actions</span>
                                    </th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                {% for lot in recent_lots %}
                                <tr class="hover:bg-gray-50 transition duration-150 ease-in-out">
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm font-medium text-indigo-600">
                                            <a href="{% url 'chine:lot_detail' lot.pk %}">{{ lot.numero }}</a>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm text-gray-900">{{ lot.destination.name }}</div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm text-gray-500">{{ lot.get_type_transport_display }}</div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span
                                            class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                                            {% if lot.status == 'OUVERT' %}bg-green-100 text-green-800{% elif lot.status == 'FERME' %}bg-yellow-100 text-yellow-800{% else %}bg-gray-100 text-gray-800{% endif %}">
                                            {{ lot.get_status_display }}
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm font-bold text-green-600">
                                            {{ lot.total_recettes|default:"0"|floatformat:0|intcomma }} FCFA
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm font-bold text-red-600">
                                            - {{ lot.frais_transport|default:"0"|floatformat:0|intcomma }} FCFA
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                        {{ lot.date_expedition|date:"d/m/Y"|default:"-" }}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                        {{ lot.created_at|date:"d M Y" }}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                        <a href="{% url 'chine:lot_detail' lot.pk %}"
                                            class="text-indigo-600 hover:text-indigo-900">G√©rer</a>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="6" class="px-6 py-4 text-center text-sm text-gray-500">
                                        Aucun lot r√©cent.
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Pagination Controls -->
                    {% if recent_lots.has_other_pages %}
                    <div class=\"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6\">\n                        <div class=\"flex-1 flex justify-between sm:hidden\">\n                            {% if recent_lots.has_previous %}\n                            <a href=\"?page={{ recent_lots.previous_page_number }}\" class=\"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50\">Pr√©c√©dent</a>\n                            {% endif %}\n                            {% if recent_lots.has_next %}\n                            <a href=\"?page={{ recent_lots.next_page_number }}\" class=\"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50\">Suivant</a>\n                            {% endif %}\n                        </div>\n                        <div class=\"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between\">\n                            <div>\n                                <p class=\"text-sm text-gray-700\">\n                                    Affichage <span class=\"font-medium\">{{ recent_lots.start_index }}</span> √† <span class=\"font-medium\">{{ recent_lots.end_index }}</span> sur <span class=\"font-medium\">{{ recent_lots.paginator.count }}</span> lots\n                                </p>\n                            </div>\n                            <div>\n                                <nav class=\"relative z-0 inline-flex rounded-md shadow-sm -space-x-px\" aria-label=\"Pagination\">\n                                    {% if recent_lots.has_previous %}\n                                    <a href=\"?page={{ recent_lots.previous_page_number }}\" class=\"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50\">\n                                        <svg class=\"h-5 w-5\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\" aria-hidden=\"true\">\n                                            <path fill-rule=\"evenodd\" d=\"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z\" clip-rule=\"evenodd\" />\n                                        </svg>\n                                    </a>\n                                    {% endif %}\n                                    \n                                    {% for num in recent_lots.paginator.page_range %}\n                                        {% if recent_lots.number == num %}\n                                        <span class=\"z-10 bg-indigo-50 border-indigo-500 text-indigo-600 relative inline-flex items-center px-4 py-2 border text-sm font-medium\">{{ num }}</span>\n                                        {% elif num > recent_lots.number|add:'-3' and num < recent_lots.number|add:'3' %}\n                                        <a href=\"?page={{ num }}\" class=\"bg-white border-gray-300 text-gray-500 hover:bg-gray-50 relative inline-flex items-center px-4 py-2 border text-sm font-medium\">{{ num }}</a>\n                                        {% endif %}\n                                    {% endfor %}\n                                    \n                                    {% if recent_lots.has_next %}\n                                    <a href=\"?page={{ recent_lots.next_page_number }}\" class=\"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50\">\n                                        <svg class=\"h-5 w-5\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\" aria-hidden=\"true\">\n                                            <path fill-rule=\"evenodd\" d=\"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z\" clip-rule=\"evenodd\" />\n                                        </svg>\n                                    </a>\n                                    {% endif %}\n                                </nav>\n                            </div>\n                        </div>\n                    </div>\n                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}